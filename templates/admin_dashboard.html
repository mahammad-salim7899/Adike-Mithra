{% extends "base.html" %}

{% block title %}Admin Dashboard - Adike Mitra{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Admin Welcome Card -->
    <div class="welcome-card admin-welcome">
        <div class="welcome-content">
            <div class="welcome-info">
                <span class="greeting-text">Administrator</span>
                <h1 class="user-name">System Dashboard</h1>
                <div class="user-info-badges">
                    <span class="info-badge admin-badge">
                        <i class="fas fa-shield-alt"></i> Admin Access
                    </span>
                    <span class="info-badge admin-badge">
                        <i class="fas fa-database"></i> Full Control
                    </span>
                    <span class="info-badge admin-badge">
                        <i class="fas fa-chart-line"></i> Analytics
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: #673AB7;">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_users }}</h3>
                <p>Total Users</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #4CAF50;">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_detections }}</h3>
                <p>Disease Detections</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #2196F3;">
                <i class="fas fa-tint"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_irrigation_logs }}</h3>
                <p>Irrigation Logs</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #FF5722;">
                <i class="fas fa-database"></i>
            </div>
            <div class="stat-content">
                <h3>Active</h3>
                <p>System Status</p>
            </div>
        </div>
    </div>

    <!-- Admin Actions -->
    <div class="admin-actions-section">
        <h2><i class="fas fa-tools"></i> Quick Actions</h2>
        <div class="admin-actions-grid">
            <!-- Update Prices Card -->
            <div class="action-card action-primary">
                <div class="action-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="action-content">
                    <h3>Market Prices</h3>
                    <p>Update arecanut prices</p>
                    <button class="btn btn-primary" onclick="showPriceModal()">Update Prices</button>
                </div>
            </div>

            <!-- View Users Card -->
            <div class="action-card action-info">
                <div class="action-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="action-content">
                    <h3>User Management</h3>
                    <p>{{ total_users }} registered users</p>
                    <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">View Users</a>
                </div>
            </div>

            <!-- View Detections Card -->
            <div class="action-card action-success">
                <div class="action-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="action-content">
                    <h3>Detection Records</h3>
                    <p>{{ total_detections }} total detections</p>
                    <a href="{{ url_for('admin_detections') }}" class="btn btn-secondary">View All</a>
                </div>
            </div>

            <!-- System Settings Card -->
            <div class="action-card action-warning">
                <div class="action-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="action-content">
                    <h3>System Settings</h3>
                    <p>Configure parameters</p>
                    <a href="{{ url_for('system_settings') }}" class="btn btn-secondary">Configure</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Price Update Modal -->
<div id="priceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-chart-line"></i> Update Market Prices</h2>
            <span class="close" onclick="closePriceModal()">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('update_prices') }}" class="modal-form">
            <div class="form-group">
                <label for="source">Source</label>
                <select id="source" name="source" required>
                    <option value="CAMPCO Mangalore">CAMPCO Mangalore</option>
                    <option value="Local Mandi">Local Mandi</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="red_price">Red Arecanut Price (₹/quintal)</label>
                <input type="number" id="red_price" name="red_price" step="0.01" required>
            </div>

            <div class="form-group">
                <label for="white_price">White Arecanut Price (₹/quintal)</label>
                <input type="number" id="white_price" name="white_price" step="0.01" required>
            </div>

            <div class="form-group">
                <label for="grade">Grade</label>
                <select id="grade" name="grade" required>
                    <option value="Grade A">Grade A</option>
                    <option value="Grade B">Grade B</option>
                    <option value="Grade C">Grade C</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Update Prices</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showPriceModal() {
    document.getElementById('priceModal').style.display = 'flex';
}

function closePriceModal() {
    document.getElementById('priceModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('priceModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>
{% endblock %}
